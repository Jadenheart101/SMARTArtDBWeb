<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Art Info Media File ID Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .btn { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; margin: 5px; border-radius: 4px; }
        .btn:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
    </style>
</head>
<body>
    <h1>Test: Art Info Media File ID Fix</h1>
    
    <div class="test-section">
        <h3>üîç Problem: Art info was trying to use filenames as media IDs</h3>
        <p><strong>Error:</strong> "Media file with ID 1754743997357_qsutbgg.jpg not found"</p>
        <p><strong>Cause:</strong> Frontend was passing filename instead of numeric media file ID</p>
        <p><strong>Fix:</strong> Modified showAddArtInfoModal() to lookup actual media file ID by filename</p>
    </div>
    
    <div class="test-section">
        <h3>üìã Test Media File Lookup</h3>
        <button class="btn" onclick="testMediaFileLookup()">Test Media File Lookup</button>
        <div id="lookupResult" class="result" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <h3>üé® Test Art Info Modal (Simulated)</h3>
        <button class="btn" onclick="testArtInfoModal()">Test Art Info Modal with Filename</button>
        <div id="modalResult" class="result" style="display: none;"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api';
        
        // Mock user data
        localStorage.setItem('currentUser', JSON.stringify({
            id: 1,
            username: 'testuser',
            UserName: 'Test User'
        }));
        
        async function testMediaFileLookup() {
            const resultDiv = document.getElementById('lookupResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.innerHTML = 'üîÑ Testing media file lookup...';
            
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                const response = await fetch(`${API_BASE_URL}/media/files?userId=${currentUser.id}`);
                const result = await response.json();
                
                if (result.success && result.files) {
                    console.log('üìÅ Available media files:', result.files);
                    
                    let html = '<h4>‚úÖ Media Files Found:</h4><ul>';
                    result.files.forEach(file => {
                        html += `<li><strong>ID:</strong> ${file.id} | <strong>Filename:</strong> ${file.filename} | <strong>URL:</strong> ${file.url}</li>`;
                    });
                    html += '</ul>';
                    
                    // Test lookup with a problematic filename
                    const testFilename = 'qsutbgg.jpg';
                    const mediaFile = result.files.find(file => 
                        file.filename === testFilename || 
                        file.file_name === testFilename ||
                        file.original_filename === testFilename ||
                        file.filename.includes('qsutbgg')
                    );
                    
                    if (mediaFile) {
                        html += `<h4>üéØ Test Lookup Result:</h4>`;
                        html += `<p>Searching for filename containing "qsutbgg":</p>`;
                        html += `<p><strong>Found:</strong> ID ${mediaFile.id} ‚Üí ${mediaFile.filename}</p>`;
                        resultDiv.className = 'result success';
                    } else {
                        html += `<h4>‚ö†Ô∏è Test Lookup Result:</h4>`;
                        html += `<p>No file found containing "qsutbgg" - this is normal if you haven't uploaded any test files.</p>`;
                        resultDiv.className = 'result';
                    }
                    
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `‚ùå Failed to load media files: ${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
        
        async function testArtInfoModal() {
            const resultDiv = document.getElementById('modalResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.innerHTML = 'üîÑ Testing art info modal logic...';
            
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                const testFilename = 'qsutbgg.jpg';
                
                // Simulate the fixed showAddArtInfoModal logic
                console.log('üé® Simulating showAddArtInfoModal with filename:', testFilename);
                
                const response = await fetch(`${API_BASE_URL}/media/files?userId=${currentUser.id}`);
                const result = await response.json();
                
                if (result.success && result.files) {
                    const mediaFile = result.files.find(file => 
                        file.filename === testFilename || 
                        file.file_name === testFilename ||
                        file.original_filename === testFilename ||
                        file.filename.includes('qsutbgg')
                    );
                    
                    if (mediaFile) {
                        const imageInfo = {
                            id: mediaFile.id, // ‚úÖ Now using numeric ID
                            src: mediaFile.url,
                            name: mediaFile.customName || mediaFile.originalName || mediaFile.filename,
                            file_name: mediaFile.filename
                        };
                        
                        resultDiv.className = 'result success';
                        resultDiv.innerHTML = `
                            <h4>‚úÖ Art Info Modal Fix Test - SUCCESS</h4>
                            <p><strong>Input:</strong> Filename "${testFilename}"</p>
                            <p><strong>Found Media File:</strong></p>
                            <ul>
                                <li><strong>ID:</strong> ${imageInfo.id} (numeric ‚úÖ)</li>
                                <li><strong>Name:</strong> ${imageInfo.name}</li>
                                <li><strong>URL:</strong> ${imageInfo.src}</li>
                                <li><strong>Filename:</strong> ${imageInfo.file_name}</li>
                            </ul>
                            <p><strong>‚úÖ This numeric ID will now work with the backend validation!</strong></p>
                        `;
                    } else {
                        resultDiv.className = 'result';
                        resultDiv.innerHTML = `
                            <h4>‚ÑπÔ∏è Art Info Modal Test - No Test File</h4>
                            <p>No file containing "qsutbgg" found for testing.</p>
                            <p>The fix is implemented and will work when real files are present.</p>
                            <p><strong>Available files:</strong> ${result.files.length}</p>
                        `;
                    }
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `‚ùå Failed to load media files: ${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
        
        console.log('üß™ Art Info Media File ID Fix Test Page Loaded');
        console.log('üìã The fix ensures that when art info is submitted, it uses numeric media file IDs instead of filenames');
    </script>
</body>
</html>
